<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="dwfault@163.com"><title>WebKit JavaScriptCore的特殊调试技巧 · dwfault</title><meta name="description" content="一、jsc内置函数jsc作为WebKit的JavaScriptCore的一个独立的可执行实体，其内置了一些特殊函数来帮助调试。这些函数位于JavaScriptCore/jsc.cpp，在finishCreation函数中通过addFunction函数注册：
123456789101112131415"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">dwfault</a></h3></div></div><ul class="social-links"><li><a href="https://twitter.com/dwfault"><i class="fa fa-twitter"></i></a></li><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="http://weibo.com/dwfault"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/dwfault"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>WebKit JavaScriptCore的特殊调试技巧</a></h3></div><div class="post-content"><h3 id="一、jsc内置函数"><a href="#一、jsc内置函数" class="headerlink" title="一、jsc内置函数"></a>一、jsc内置函数</h3><p>jsc作为WebKit的JavaScriptCore的一个独立的可执行实体，其内置了一些特殊函数来帮助调试。这些函数位于JavaScriptCore/jsc.cpp，在finishCreation函数中通过addFunction函数注册：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">addFunction(vm, <span class="string">"debug"</span>, functionDebug, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"describe"</span>, functionDescribe, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"describeArray"</span>, functionDescribeArray, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"print"</span>, functionPrintStdOut, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"printErr"</span>, functionPrintStdErr, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"quit"</span>, functionQuit, <span class="number">0</span>);</span><br><span class="line">addFunction(vm, <span class="string">"gc"</span>, functionGCAndSweep, <span class="number">0</span>);</span><br><span class="line">addFunction(vm, <span class="string">"fullGC"</span>, functionFullGC, <span class="number">0</span>);</span><br><span class="line">addFunction(vm, <span class="string">"edenGC"</span>, functionEdenGC, <span class="number">0</span>);</span><br><span class="line">addFunction(vm, <span class="string">"forceGCSlowPaths"</span>, functionForceGCSlowPaths, <span class="number">0</span>);</span><br><span class="line">addFunction(vm, <span class="string">"gcHeapSize"</span>, functionHeapSize, <span class="number">0</span>);</span><br><span class="line">...</span><br><span class="line">addFunction(vm, <span class="string">"addressOf"</span>, functionAddressOf, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"run"</span>, functionRun, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"runString"</span>, functionRunString, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"load"</span>, functionLoad, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"loadString"</span>, functionLoadString, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"readFile"</span>, functionReadFile, <span class="number">2</span>);</span><br><span class="line">addFunction(vm, <span class="string">"read"</span>, functionReadFile, <span class="number">2</span>);</span><br><span class="line">...</span><br><span class="line">addFunction(vm, <span class="string">"jscStack"</span>, functionJSCStack, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"readline"</span>, functionReadline, <span class="number">0</span>);</span><br><span class="line">...</span><br><span class="line">addFunction(vm, <span class="string">"neverInlineFunction"</span>, functionNeverInlineFunction, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"noInline"</span>, functionNeverInlineFunction, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"noDFG"</span>, functionNoDFG, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"noFTL"</span>, functionNoFTL, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"noOSRExitFuzzing"</span>, functionNoOSRExitFuzzing, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"numberOfDFGCompiles"</span>, functionNumberOfDFGCompiles, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"jscOptions"</span>, functionJSCOptions, <span class="number">0</span>);</span><br><span class="line">addFunction(vm, <span class="string">"optimizeNextInvocation"</span>, functionOptimizeNextInvocation, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"reoptimizationRetryCount"</span>, functionReoptimizationRetryCount, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"transferArrayBuffer"</span>, functionTransferArrayBuffer, <span class="number">1</span>);</span><br><span class="line">addFunction(vm, <span class="string">"failNextNewCodeBlock"</span>, functionFailNextNewCodeBlock, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>这些函数不是ECMAScript标准涉及的函数，一般的JavaScript引擎实现中也不包含这些函数。可以认为这些函数是为了方便开发者而置入的。例如print函数用来打印变量到控制台，在nodejs等环境中对应console.log。这些函数很有用处，可以大大简化调试。例如函数describe、describeArray可以透露很多信息：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> split = <span class="string">'------'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>,<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">print(describe(a));</span><br><span class="line">print(split);</span><br><span class="line">print(describeArray(a));</span><br><span class="line">print(split);</span><br><span class="line">print(addressOf(a));</span><br><span class="line">print(<span class="string">'0x'</span> + f64_to_uint(addressOf(a)).toString(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line">print(split);</span><br><span class="line">a.length = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">print(describe(a));</span><br><span class="line">print(split);</span><br><span class="line">print(describeArray(a));</span><br><span class="line">print(split);</span><br><span class="line">print(addressOf(a));</span><br><span class="line">print(<span class="string">'0x'</span> + f64_to_uint(addressOf(a)).toString(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f64_to_uint</span>(<span class="params">f64</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bytes = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(<span class="keyword">new</span> <span class="built_in">Float64Array</span>([f64]).buffer);</span><br><span class="line">    <span class="keyword">if</span> (bytes.length != <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (debug)</span><br><span class="line">            print(<span class="string">"f64_to_u64 error."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> uint = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span><br><span class="line">        uint += (bytes[bytes.length - i - <span class="number">1</span>] * <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">0x38</span> - i * <span class="number">8</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> uint</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到如下内容，从中甚至可以看到对象的transition变化：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Object: <span class="number">0x62d0000a4340</span> with butterfly <span class="number">0x62d0001a8010</span> (Structure <span class="number">0x62d00000ec30</span>:[Array, &#123;&#125;, CopyOnWriteArrayWithInt32, Proto:<span class="number">0x62d00007c0a0</span>, Leaf]), StructureID: <span class="number">102</span></span><br><span class="line">------</span><br><span class="line">&lt;Butterfly: <span class="number">0x62d0001a8010</span>; <span class="keyword">public</span> length: <span class="number">2</span>; <span class="built_in">vector</span> length: <span class="number">2</span>&gt;</span><br><span class="line">------</span><br><span class="line"><span class="number">5.3678005860554e-310</span></span><br><span class="line"><span class="number">0x62d0000a4340</span></span><br><span class="line">------</span><br><span class="line">Object: <span class="number">0x62d0000a4340</span> with butterfly <span class="number">0x62d000220008</span> (Structure <span class="number">0x62d00000ea00</span>:[Array, &#123;&#125;, ArrayWithInt32, Proto:<span class="number">0x62d00007c0a0</span>, Leaf]), StructureID: <span class="number">97</span></span><br><span class="line">------</span><br><span class="line">&lt;Butterfly: <span class="number">0x62d000220008</span>; <span class="keyword">public</span> length: <span class="number">3</span>; <span class="built_in">vector</span> length: <span class="number">3</span>&gt;</span><br><span class="line">------</span><br><span class="line"><span class="number">5.3678005860554e-310</span></span><br><span class="line"><span class="number">0x62d0000a4340</span></span><br></pre></td></tr></table></figure>
<p>也可以获得JS的执行栈：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    f64_to_uint(<span class="number">5.3678005860554e-310</span> + <span class="built_in">parseInt</span>(jscStack()));</span><br><span class="line">&#125;</span><br><span class="line">f();</span><br></pre></td></tr></table></figure>
<p>得到：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--&gt; Stack trace:</span><br><span class="line">    <span class="number">0</span>   jscStack@[native code]</span><br><span class="line">    <span class="number">1</span>   f@yuebao.js:<span class="number">36</span>:<span class="number">57</span></span><br><span class="line">    <span class="number">2</span>   global code@yuebao.js:<span class="number">39</span>:<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>另外，noDFG、noFTL等函数规定了特定js函数在JIT时的特定行为；gc、fullGC、edenGC可以控制垃圾回收等。由于依靠这些函数的漏洞触发不会被承认，所以这些函数看起来比较鸡肋，还是要手动触发jit、gc比较符合常理。因此这些函数在jsc中的高阶用法在这里不再讨论。</p>
<p>阅读这些函数可以理解很多基本类型的用法和关系，例如JSValue、jsNumber、jsString、Butterfly、Array、WTF::Vector。</p>
<h3 id="二、使用Arrary-prototype-slice下断点"><a href="#二、使用Arrary-prototype-slice下断点" class="headerlink" title="二、使用Arrary.prototype.slice下断点"></a>二、使用Arrary.prototype.slice下断点</h3><p>类似于IE漏洞分析中的tan等函数，Array.prototype.slice也可以被用作断点。目标函数位于JavaScriptCore/runtime/ArrayPrototype.cpp：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b arrayProtoFuncSlice</span><br></pre></td></tr></table></figure>
<p>在js中直接引用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.slice([]);</span><br></pre></td></tr></table></figure>
<p>断下后会停在该函数的开头。</p>
<h3 id="三、自定义dbg-函数下断点"><a href="#三、自定义dbg-函数下断点" class="headerlink" title="三、自定义dbg()函数下断点"></a>三、自定义dbg()函数下断点</h3><p>可以使用x86 int3指令自定义一个断点函数dbg()进行调试。在jsc中自定义函数只需要三个步骤：</p>
<ul>
<li><p>声明函数</p>
</li>
<li><p>定义函数</p>
</li>
<li>注册函数<ul>
<li>addFunction的第二个参数是对应的js函数的名字，第四个参数是js函数的参数的个数。</li>
</ul>
</li>
</ul>
<p><img src="WebKit JavaScriptCore的特殊调试技巧.assets/image-20190103172422856-6507462.png" alt="image-20190103172422856"></p>
<p>自定义的Native函数参数统一为ExecState类型，这是一个为了确定上下文的类型。在使用addFunction注册函数时，第二个参数是该函数参数个数，这些参数可以通过ExecState类型的exec参数取得，因此dbg()函数还可以定义为有参数的函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> dbgBrCnt = <span class="number">0</span>;</span><br><span class="line"><span class="function">EncodedJSValue JSC_HOST_CALL <span class="title">functionDbg</span><span class="params">(ExecState* exec)</span></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> times = exec-&gt;uncheckedArgument(<span class="number">0</span>).toInteger(exec);</span><br><span class="line">    <span class="keyword">if</span>(dbgBrCnt &lt; times)&#123;&#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">asm</span>(<span class="string">"int3;"</span>);</span><br><span class="line">    dbgBrCnt++;</span><br><span class="line">    <span class="keyword">return</span> JSValue::encode(jsUndefined());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此实现了一个条件断点，这样可以让函数在循环到某确定次数的时候陷入int3，比如下面定义的是一个到达1000次之后触发的断点函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbg(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>当然上述定义的断点适合简单的情况，只有一个断点的时候是可运行的。</p>
<p>functionDbg()的内容还可以更多样化地进行定制。这在调试JIT、垃圾回收等等复杂情况的时候尤其有用。</p>
<h3 id="四、为dbg-函数适配DFG-JIT"><a href="#四、为dbg-函数适配DFG-JIT" class="headerlink" title="四、为dbg()函数适配DFG JIT"></a>四、为dbg()函数适配DFG JIT</h3><p>上述所有内容都是JSC_HOST_CALL类型的静态函数，在JIT当中使用这些函数会不可避免地使栈回溯发生变化，因为存在一个从JITed代码跳转出来的过程；有时候还会为DFG JIT添加OSRExit的退出点，使得本来应该触发的漏洞在dbg()函数提前回退，导致漏洞无法触发。</p>
<p>JavaScriptCore的运行是一个比较复杂的过程，可以参考《MOSEC2018分享》中的内容，程序运行的上下文会经常在Baseline JIT和DFG JIT生成的代码之间切换。于是上文中的functionDbg()函数：</p>
<ul>
<li>基本不会影响到Baseline JIT代码生成，只是相当于在一段直线式程序中添加结点。<ul>
<li>调试时，正常通过该结点即可。</li>
</ul>
</li>
<li>会极大地影响DFG JIT代码生成。<ul>
<li>由DirectCall(DFG IR)调用，从JITed代码跳转出来<ul>
<li>后跟InvalidationPoint(DFG IR)结点</li>
<li>后跟CheckStructure(DFG IR)结点</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>因此，dbg()函数可以保证插入点之前的代码的执行情况是与不插入的情况吻合的，但其后的代码执行逻辑可能会发生改变。例如，在JavaScriptCore JIT系统中最典型的类型混淆漏洞，其中有：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">前文</span><br><span class="line">类型混淆的赋值</span><br><span class="line">后文</span><br></pre></td></tr></table></figure>
<p>为了观察类型混淆漏洞，会在“类型混淆的赋值”之前插入一个DirectCall结点调用dbg()：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">前文</span><br><span class="line">DirectCall</span><br><span class="line">CheckStructure</span><br><span class="line">InvalidationPoint</span><br><span class="line">类型混淆的赋值</span><br><span class="line">后文</span><br></pre></td></tr></table></figure>
<p>于是在CheckStructure之后程序就进行了OSRExit，无法到达“类型混淆的赋值”，因此发生所谓观察者效应，调试失败。</p>
<p>为了解决这个问题，可以把CheckStructure这一DFG IR的编译过程注释掉，这样就可以随心所欲地下断点了：</p>
<p>JavaScriptCore/dfg/DFGSpeculativeJIT64.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SpeculativeJIT::compile(Node * node)</span><br><span class="line">    <span class="keyword">case</span> CheckStructure:&#123;</span><br><span class="line">        <span class="comment">//compileCheckStructure(node);</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，这样的情况不适用CheckStructure本身出问题的情况。</p>
<p>在其他的情况下，为了去掉InvalidationPoint还通过可以修改DirectCall这一DFG IR的读写属性标识，将其指明的Side Effect去掉：</p>
<p>JavaScriptCore/dfg/DFGClobberize.h</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (node-&gt;op())&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">case</span> DirectCall:</span><br><span class="line">        <span class="comment">//read(World);</span></span><br><span class="line">        read(Heap);</span><br><span class="line">        <span class="comment">//write(Heap);</span></span><br><span class="line">        write(SideState);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="五、DFG-JIT代码断点"><a href="#五、DFG-JIT代码断点" class="headerlink" title="五、DFG JIT代码断点"></a>五、DFG JIT代码断点</h3><p>更直观的方法，是在DFG代码生成的位置下断点：</p>
<p><img src="WebKit JavaScriptCore的特殊调试技巧.assets/image-20190103172811046-6507691.png" alt="image-20190103172811046"></p>
<p>需要参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--dumpDFGDisassembly=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>配合内存dump+反汇编器分析更容易。</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-12-20</span><i class="fa fa-tag"></i></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://dwfault.github.io/2019/12/20/WebKit JavaScriptCore的特殊调试技巧/,dwfault,WebKit JavaScriptCore的特殊调试技巧,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/12/20/XCode编译WebKit JavaScriptCore问题解决/" title="XCode编译WebKit JavaScriptCore问题解决">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/12/20/CVE-2019-8518 FTL LICM GetByVal hoisted OOB/" title="CVE-2019-8518 FTL LICM GetByVal hoisted OOB">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>